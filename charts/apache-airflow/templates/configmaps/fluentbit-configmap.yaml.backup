apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-configuration
  labels:
    fluent-bit-config: worker-task-logs
data:
  fluent-bit.yaml: |
    service:
      flush: 1
      log_level: info
      daemon: off

    input:
      - name: tail
        path: /opt/airflow/logs/dag_id=.*\/.*\/task_id=.*\/.*\.log

    filter:
    - name: grep
      match: '*'
      regex: '.*INFO - .*'
    - name: grep
      match: '*'
      regex: '.*Starting attempt.*'
    - name: grep
      match: '*'
      regex: '.*Executing <Task.*'
    - name: grep
      match: '*'
      regex: '.*Started process.*'
    - name: grep
      match: '*'
      regex: '.*Running: \['airflow'.*'
    - name: grep
      match: '*'
      regex: '.*Marking task as SUCCESS.*'
    - name: grep
      match: '*'
      regex: '.*Exporting env vars:.*'
    - name: grep
      match: '*'
      regex: '.*Task exited with return code 0.*'

    output:
      - name: stdout
        match: tail
